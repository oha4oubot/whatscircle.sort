<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ワッツ◎さーくる 楽曲ソート</title>
<style>
body {
font-family: Arial, sans-serif;
text-align: center;
background: linear-gradient(to bottom, #ffffff, #e8f8e8);
color: #5a8a5a;
margin: 0;
padding: 20px;
min-height: 100vh;
}

h1 {
color: #88b04b;
margin-bottom: 10px;
font-size: 2.4em;
text-shadow: 1px 1px 3px rgba(136,176,75,0.3);
}

.subtitle {
font-size: 1.2em;
margin-bottom: 20px;
color: #77a077;
}

.progress-text {
font-size: 2em;
font-weight: bold;
color: #88b04b;
margin: 40px 0;
}

.vs-container {
display: flex;
justify-content: center;
align-items: center;
gap: 20px;
margin: 40px auto;
flex-wrap: wrap;
}

.card {
width: 300px;
padding: 35px 20px;
background: #ffffff;
border-radius: 25px;
box-shadow: 0 10px 25px rgba(160,200,160,0.3);
cursor: pointer;
transition: all 0.3s ease;
border: 3px solid #ccffdd;
}

.card:hover {
transform: translateY(-10px) scale(1.03);
box-shadow: 0 20px 40px rgba(136,176,75,0.4);
border-color: #aaffc3;
}

.card:active {
transform: translateY(0) scale(0.98);
}

.card .title {
font-size: 1.8em;
font-weight: bold;
margin-bottom: 15px;
color: #88b04b;
}

.vs {
font-size: 3.5em;
font-weight: bold;
color: #88b04b;
margin: 0 30px;
}

.buttons {
margin-top: 40px;
}

.draw-button, .undo-button {
padding: 14px 32px;
font-size: 1.3em;
margin: 10px;
border-radius: 15px;
cursor: pointer;
font-weight: bold;
}

.draw-button {
background: #ddffdd;
color: #5a8a5a;
border: 2px solid #88b04b;
}

.draw-button:hover {
background: #bbffbb;
}

.undo-button {
background: #f0f0f0;
color: #777;
border: 2px solid #aaa;
}

.undo-button:hover {
background: #e0e0e0;
}

.undo-button:disabled {
background: #f8f8f8;
color: #bbb;
border-color: #ddd;
cursor: not-allowed;
}

.result {
margin: 40px auto;
max-width: 800px;
}

.result h2 {
color: #88b04b;
}

.result ol {
text-align: left;
background: #ffffff;
padding: 25px 35px;
border-radius: 20px;
box-shadow: 0 10px 25px rgba(160,200,160,0.3);
border: 2px solid #ccffdd;
counter-reset: ranking;
}

.result li {
font-size: 1.4em;
padding: 12px 0;
color: #5a8a5a;
counter-increment: ranking;
}

.result li::before {
content: counter(ranking) "位 ";
color: #88b04b;
font-weight: bold;
font-size: 1.1em;
}

button.restart {
padding: 16px 35px;
font-size: 1.2em;
background: #ccffdd;
color: #5a8a5a;
border: none;
border-radius: 15px;
cursor: pointer;
margin-top: 30px;
box-shadow: 0 6px 15px rgba(136,176,75,0.4);
font-weight: bold;
}

button.restart:hover {
background: #aaffc3;
transform: translateY(-3px);
}

@media (max-width: 768px) {
.vs-container {
flex-direction: column;
gap: 35px;
}

.vs {
transform: rotate(90deg);
margin: 20px 0;
}

.card {
width: 90%;
max-width: 340px;
padding: 45px 20px;
}

.card .title {
font-size: 1.7em;
}

h1 {
font-size: 2.1em;
}

.progress-text {
font-size: 1.6em;
}

.buttons {
display: flex;
flex-direction: column;
align-items: center;
}

.draw-button, .undo-button {
width: 80%;
max-width: 320px;
}
}
</style>
</head>
<body>
<h1>ワッツ◎さーくる<br>楽曲トーナメントソート</h1>
<div class="subtitle">好きな方をタップ！</div>

<div id="tournament">
<div class="progress-text" id="progress">進捗 0%</div>

<div class="vs-container">
<div class="card" id="left" onclick="choose('left')"></div>
<div class="vs">VS</div>
<div class="card" id="right" onclick="choose('right')"></div>
</div>

<div class="buttons">
<button class="draw-button" onclick="draw()">引き分け</button>
<button class="undo-button" id="undo" onclick="undo()" disabled>← 1つ前に戻る</button>
</div>
</div>

<div id="result" class="result" style="display:none;">
<h2>ランキング完成！✨</h2>
<ol id="ranking"></ol>
<button class="restart" onclick="startTournament()">もう一度やる</button>
</div>

<script>
const songs = [
"チャンス到来！ギガ盛スペクタクル",
"初恋結",
"臆病リボルター！",
"Summer Day Trip",
"薄明のポラリス",
"ミラクルサイリュウム",
"ユメ、ときどき君。",
"夏コイ花ビ",
"JU・GE・MU",
"ステップシーケンサー",
"スノービロード",
"ミライリライト",
"One way story",
"星空の彼方まで",
"ゲンダイクライマー",
"MAX！ハレルヤミュージック",
"イナズマトレイン",
"僕らの未来予想図",
"始まりはいつだって\"ド\"",
"回るよ！クルクル◎どーなっつ",
"真紅のマーガレット〜21枚目の\"スキ\"〜",
"青の日々~spring time of life~",
"まだまだまだ、最前線",
"終わりはいつだって初めの一歩",
"サマサマ☆サマトピア",
"真っ白なコンパス",
"なんでもない青空"
];

let remaining = []; // まだランキング決定してない曲
let ranking = []; // 決定したランキング（1位から順に）
let history = []; // 戻る履歴
let currentA, currentB; // 今比較中の2曲

function startTournament() {
remaining = songs.map(title => ({ title }));
ranking = [];
history = [];
document.getElementById('tournament').style.display = 'block';
document.getElementById('result').style.display = 'none';
document.getElementById('undo').disabled = true;
updateProgress();
pickNextPair();
}

function pickNextPair() {
if (remaining.length < 2) {
// 残り1曲 or 0曲 → ランキング完成
if (remaining.length === 1) ranking.push(remaining[0]);
showResult();
return;
}

// ランダムに2曲選ぶ
remaining.sort(() => Math.random() - 0.5);
currentA = remaining[0];
currentB = remaining[1];

document.getElementById('left').innerHTML = `<div class="title">${currentA.title}</div>`;
document.getElementById('right').innerHTML = `<div class="title">${currentB.title}</div>`;
}

function recordHistory() {
history.push({
remaining: remaining.map(s => ({ title: s.title })),
ranking: ranking.map(s => ({ title: s.title })),
currentA: { title: currentA.title },
currentB: { title: currentB.title }
});
document.getElementById('undo').disabled = false;
}

function choose(side) {
recordHistory();

const winner = side === 'left' ? currentA : currentB;
const loser = side === 'left' ? currentB : currentA;

// 勝者をランキング先頭に追加（1位方向）
ranking.unshift(winner);

// 負け者をremainingから削除（勝者も削除）
remaining = remaining.filter(s => s !== winner && s !== loser);

updateProgress();
pickNextPair();
}

function draw() {
recordHistory();

// 引き分け：両方ランキング先頭にランダム順で追加
if (Math.random() < 0.5) {
ranking.unshift(currentA);
ranking.unshift(currentB);
} else {
ranking.unshift(currentB);
ranking.unshift(currentA);
}

remaining = remaining.filter(s => s !== currentA && s !== currentB);

updateProgress();
pickNextPair();
}

function undo() {
if (history.length === 0) return;

const prev = history.pop();
remaining = prev.remaining.map(s => ({ title: s.title }));
ranking = prev.ranking.map(s => ({ title: s.title }));
currentA = prev.currentA;
currentB = prev.currentB;

document.getElementById('left').innerHTML = `<div class="title">${currentA.title}</div>`;
document.getElementById('right').innerHTML = `<div class="title">${currentB.title}</div>`;

if (history.length === 0) {
document.getElementById('undo').disabled = true;
}

updateProgress();
}

function updateProgress() {
const done = ranking.length;
const percent = Math.round((done / songs.length) * 100);
document.getElementById('progress').textContent = `進捗 ${percent}%`;
}

function showResult() {
document.getElementById('tournament').style.display = 'none';

const rankingList = document.getElementById('ranking');
rankingList.innerHTML = '';

ranking.forEach(song => {
const li = document.createElement('li');
li.textContent = song.title;
rankingList.appendChild(li);
});

document.getElementById('result').style.display = 'block';
}

// スタート
startTournament();
</script>
</body>
</html>